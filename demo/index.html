<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
    <style>
        label.error {
            color: red;
        }
    </style>
</head>

<body id="body">
    <div class="container mt-5">

        <div class="d-flex">
            <div id="khung" style="width: 92px;height: 50px;border: 1px solid black; border-radius: 25px;"
                class="position-relative">
                <button id="btn" style="width: 40px;height: 40px;font-size: 10px;font-weight: bold;"
                    class="btn bg-dark rounded-circle position-absolute mt-1 text-light p-2">Đêm</button>
            </div>
            <div">
                <button type="button" class="ms-2 btn" style="font-size: 1px;" id="admin">ADMIN</button>
        </div>
    </div>

    <div class="d-flex justify-content-center">
        <form id="dangky" class="w-50" style="border: 1px solid black;border-radius: 30px;">
            <h1 class="tieude text-center text-dark">Đăng ký</h1>
            <div class="p-3">
                <p><input class="w-100" type="text" name="user" id="user" placeholder="Nhập tên"></p>
                <p id="erUser" class="text-danger"></p>
                <p><input class="w-100" type="email" name="email" id="email" placeholder="Nhập email"></p>
                <p id="erEmail" class="text-danger"></p>
                <p><input class="w-100" type="password" name="password" id="pass" placeholder="Nhập password"></p>
                <p id="erPass" class="text-danger"></p>
                <p><input class="w-100" type="password" name="confirmPassword" id="checkpass"
                        placeholder="Nhập lại password"></p>
                <p id="erCheckpass" class="text-danger"></p>
            </div>
            <p class="text-center">
                <button type="submit">Đăng ký</button>
                <button type="button" class="ms-2" id="login">Đăng nhập</button>
            </p>
        </form>
    </div>

    <div class="d-flex justify-content-center">
        <form action="" id="dangnhap" class="w-50" style="border: 1px solid black;border-radius: 30px;">
            <h1 class="tieude text-center text-dark">Đăng nhập</h1>
            <div class="p-3">
                <p><input class="w-100" type="email" name="email" id="loginemail" placeholder="Email"></p>
                <p id="eremail" class="text-danger"></p>
                <p><input class="w-100" type="password" name="password" id="loginpass" placeholder="Mật khẩu"></p>
                <p id="erpass" class="text-danger"></p>
            </div>
            <p class="text-center">
                <button type="submit">Đăng nhập</button>
                <button type="button" class="ms-2" id="logup">Đăng ký</button>
            </p>
        </form>
    </div>
    <div id="noidung" class="text-dark text-center">
        <p>
            <img style="width: 50px;height: 50px;" class="img-fluid" src="./user.png" alt="">
            <button class="btn"><strong><span class="text-dark" id="tenuser"></span></strong></button>
            <button class="btn" id="logout">Đăng xuẩt</button>
        </p>
        <div id="thongtin">
            <p><strong>Tên người dùng:</strong> <span id="showUser"></span></p>
            <p><strong>Email:</strong> <span id="showEmail"></span></p>
            <p><strong>Mật khẩu:</strong> <span id="showPass"></span></p>
            <p><button id="removeuser" class="btn text-dark">Xóa tài khoản</button></p>
        </div>
    </div>

    <div class="d-flex justify-content-center text-dark">
        <div id="quanly">
            <h1>ADMIN</h1>
            <div>
                <p><input type="text" name="" id="userAD" placeholder="Tài khoản"></p>
                <p><input type="password" name="" id="passAD" placeholder="Mật khẩu"></p>
            </div>
            <p>
                <button id="adlogin">Login</button>
                <button id="quaylai">Quay lại</button>
            </p>
        </div>
    </div>
    <div class="d-flex justify-content-center">
        <div id="qltaikhoan">
            <button id="Clear">Clear</button>
            <button id="quaylaiad">Quay lại</button>
            <input type="email" name="" id="xoaid" placeholder="Xóa tài khoản: email">
            <input type="password" name="" id="xoapass" placeholder="Mật khẩu">
            <button id="xoatk">Xóa</button>
            <div id="taikhoan">

            </div>
        </div>
    </div>
    </div>

    <script>
        $(document).ready(function () {
            $("#quanly").hide()
            $("#qltaikhoan").hide()
            $("#dangnhap").hide()
            $("#noidung").hide()
            $("#thongtin").hide()

            $("#tenuser").click(function () {
                $("#thongtin").slideToggle()
            });
            $("#Clear").click(function () {
                localStorage.clear()
            })
            $("#login").click(function () {
                $("#dangky").hide()
                $("#dangnhap").show()
            })
            $("#logup").click(function () {
                $("#dangky").show()
                $("#dangnhap").hide()
                $("#loginemail").val("")
                $("#loginpass").val("")
            })
            $("#logout").click(function () {
                $("#noidung").hide()
                $("#thongtin").hide()
                $("#dangnhap").show()
                $("#admin").show()
            })
            $("#admin").click(function () {
                $("#quanly").show()
                $("#dangnhap").hide()
                $("#dangky").hide()
                $("#noidung").hide()
                $("#thongtin").hide()
                $("#userAD").val("")
                $("#passAD").val("")
            })
            $("#quaylaiad").click(function () {
                $("#qltaikhoan").hide()
                $("#dangnhap").show()
            })
            $("#quaylai").click(function () {
                $("#quanly").hide()
                $("#dangnhap").show()
            })
            $("#xoatk").click(function () {
                // AD có thể kiểm tra và xóa tài khoản nếu cần thiết
                let email = $("#xoaid").val().trim();
                let pass = $("#xoapass").val().trim();

                if (!email || !pass) {
                    alert("Vui lòng nhập đầy đủ email và mật khẩu");
                    return;
                }

                let info = localStorage.getItem(email);
                if (!info) {
                    alert("Tài khoản không tồn tại");
                    return;
                }

                let data = JSON.parse(info);
                if (data.pass !== pass) {
                    alert("Mật khẩu không đúng");
                    return;
                }

                if (confirm("Bạn có chắc chắn muốn xóa tài khoản này không?")) {
                    localStorage.removeItem(email);
                    alert("Đã xóa tài khoản thành công");

                    // Xóa xong thì xóa input và cập nhật danh sách tài khoản
                    $("#xoaid").val("");
                    $("#xoapass").val("");

                    // Làm mới danh sách hiển thị
                    $("#taikhoan").empty();
                    for (let i = 0; i < localStorage.length; i++) {
                        let key = localStorage.key(i);
                        if (key !== "currentUser") {
                            let info = JSON.parse(localStorage.getItem(key));
                            if (info && info.user && info.email && info.pass) {
                                let html = `<p><strong>Tên:</strong> ${info.user} | <strong>Email:</strong> ${info.email} | <strong>Mật khẩu:</strong> ${info.pass}</p>`;
                                $("#taikhoan").append(html);
                            }
                        }
                    }
                }
            });
            $("#adlogin").click(function () {
                let admin = $("#userAD").val().trim()
                let passadmin = $("#passAD").val().trim()

                if (admin === "" || passadmin === "") {
                    alert("Chưa điền thông tin")
                } else if (admin === "admin" || passadmin === "admin") {
                    alert("Đăng nhập thành công")

                    $("#quanly").hide()
                    $("#qltaikhoan").show()

                    $("#taikhoan").empty(); // xóa sạch trước khi hiển thị lại
                    for (let i = 0; i < localStorage.length; i++) {
                        let key = localStorage.key(i);
                        if (key !== "currentUser") {
                            let info = JSON.parse(localStorage.getItem(key));
                            if (info && info.user && info.email && info.pass) {
                                let html = `<p><strong>Tên:</strong> ${info.user} | <strong>Email:</strong> ${info.email} | <strong>Mật khẩu:</strong> ${info.pass}</p>`;
                                $("#taikhoan").append(html);
                            }
                        }
                    }
                } else {
                    alert("Tài khoản hoặc mật khẩu không đúng")
                }
            })

            $("#btn").hover(
                function () {
                    $(this).css({
                        "border": "3px solid green",
                    })
                },
                function () {
                    $(this).css({
                        "border": "0px solid green",
                    })
                },
            )
            let dichuyen = true
            $("#btn").click(function () {
                $("#body").toggleClass("bg-dark")

                if (dichuyen) {
                    $("#btn").animate({ left: "50px" }, 400).addClass("bg-light text-dark").removeClass("bg-dark text-light").text("Ngày")
                } else {
                    $("#btn").animate({ left: "0px" }, 400).addClass("bg-dark text-light").removeClass("bg-light text-dark").text("Đêm")
                }
                dichuyen = !dichuyen

                if ($("#body").hasClass("bg-dark")) {
                    $("#khung").css("border", "1px solid white")
                } else {
                    $("#khung").css("border", "1px solid black")
                }

                if ($("#body").hasClass("bg-dark")) {
                    $("#dangky, #dangnhap").css("border", "1px solid white")
                    $(".tieude").addClass("text-light").removeClass("text-dark")
                    $("#noidung").addClass("text-light").removeClass("text-dark")
                    $("#removeuser").addClass("text-light").removeClass("text-dark")
                    $("#tenuser").addClass("text-light").removeClass("text-dark")
                    $("#quanly").addClass("text-light").removeClass("text-dark")
                    $("#logout").addClass("text-light").removeClass("text-dark")
                    $("#taikhoan").addClass("text-light").removeClass("text-dark")
                } else {
                    $("#dangky, #dangnhap").css("border", "1px solid black")
                    $(".tieude").addClass("text-dark").removeClass("text-light")
                    $("#noidung").addClass("text-dark").removeClass("text-light")
                    $("#removeuser").addClass("text-dark").removeClass("text-light")
                    $("#tenuser").addClass("text-dark").removeClass("text-light")
                    $("#quanly").addClass("text-dark").removeClass("text-light")
                    $("#logout").addClass("text-dark").removeClass("text-light")
                    $("#taikhoan").addClass("text-dark").removeClass("text-light")
                }
            })
            $.validator.addMethod("upercase", function (value, element) {
                return /[A-Z]/.test(value)
            }, "Cần ít nhất 1 chữ viết hoa")
            $.validator.addMethod("noSpace", function (value, element) {
                return value.indexOf(" ") === -1
            }, "Vui lòng k nhập khoảng trắng")
            $.validator.addMethod("vietthuong", function (value, element) {
                return /[a-z]/.test(value)
            }, "Cần ít nhất 1 chữ viết thường")
            $("#dangky").validate({
                rules: {
                    user: {
                        required: true,
                        upercase: true,
                        noSpace: true,
                        vietthuong: true,
                    },
                    email: {
                        required: true,
                        email: true,
                        noSpace: true,
                    },
                    password: {
                        required: true,
                        noSpace: true,
                        minlength: 8,
                    },
                    confirmPassword: {
                        required: true,
                        noSpace: true,
                        minlength: 8,
                        equalTo: "#pass"
                    }
                },
                messages: {
                    user: {
                        required: "Chưa nhập tên",
                    },
                    email: {
                        required: "Chưa nhập email",
                        email: "Hãy nhập đúng định dạng emil",
                    },
                    password: {
                        required: "Chưa nhập mật khẩu",
                        minlength: "Chứa ít nhất 8 ký tự"
                    },
                    confirmPassword: {
                        required: "Nhập lại mật khẩu",
                        minlength: "Chứa ít nhất 8 ký tự",
                        equalTo: "Mật khẩu không trùng khớp",
                    }
                },
                submitHandler: function (form) {
                    let user = $("#user").val().trim()
                    let email = $("#email").val().trim()
                    let pass = $("#pass").val().trim()

                    if (localStorage.getItem(email) !== null) {
                        alert("Email đã tồn tại, vui lòng dùng email khác.")
                        return
                    }//kiểm tra email đã tồn tại chưa

                    let info = {
                        user,
                        email,
                        pass,
                    }
                    localStorage.setItem(email, JSON.stringify(info))
                    alert("Đăng ký thành công")

                    let html = `<p><strong>Tên:</strong> ${user} | <strong>Email:</strong> ${email} | <strong>Mật khẩu:</strong> ${pass}</p>`;
                    $("#taikhoan").append(html)

                    //lưu thông tin vào admin

                    $("#dangky").hide()
                    $("#dangnhap").show()
                    form.reset()
                }
            })

            $("#dangnhap").validate({
                rules: {
                    email: {
                        required: true,
                        email: true,
                    },
                    password: {
                        required: true,
                        minlength: 8
                    }
                },
                messages: {
                    email: {
                        required: "Chưa nhập email",
                        email: "Email không hợp lệ"
                    },
                    password: {
                        required: "Chưa nhập mật khẩu",
                        minlength: "Chứa ít nhất 8 ký tự"
                    }
                },
                submitHandler: function (form) {
                    let Email = $("#loginemail").val().trim()
                    let Pass = $("#loginpass").val().trim()
                    let checklog = localStorage.getItem(Email) // kiểm tra xem email có tồn tại k
                    if (checklog) {
                        let info = JSON.parse(checklog); // chuyển đổi thành dạng có thể đọc đc, mới lưu ở phần đăng ký là user email pass
                        if (info.pass === Pass) {
                            alert("Đăng nhập thành công")
                            $("#admin").hide()
                            form.reset()
                            $("#tenuser").text(info.user)//hiển thị tên lên bút bấm
                            localStorage.setItem("currentUser", JSON.stringify(info))// lưu phần thông tin đăng ký vào biến có tên trong ""
                            $("#dangnhap").hide()
                            let current = localStorage.getItem("currentUser")// gán biến cho tên trong "" khi đăng nhập thành công đc lưu trữ
                            if (current) {
                                let data = JSON.parse(current)// chuyển dữ liệu và lưu thành biến data
                                $("#showUser").text(data.user)// gọi data.user, .user trỏ đến lớp info đc đc lưu trữ trc lúc đăng ký
                                $("#showEmail").text(data.email)
                                $("#showPass").text(data.pass)
                            }
                            $("#noidung").show()
                        } else {
                            alert("Mật khẩu không đúng")
                        }
                    } else {
                        alert("Email không tồn tại")
                    }
                }
            })
            $("#removeuser").click(function () {
                let current = localStorage.getItem("currentUser");
                if (current) {
                    let info = JSON.parse(current);
                    let email = info.email;

                    // Xác nhận xóa
                    if (confirm("Bạn có chắc chắn muốn xóa tài khoản này không?")) {
                        localStorage.removeItem(email);         // Xóa tài khoản theo email
                        localStorage.removeItem("currentUser"); // Xóa trạng thái đang đăng nhập
                        alert("Tài khoản đã được xóa thành công.");

                        // Ẩn các phần liên quan và reset lại giao diện
                        $("#noidung").hide();
                        $("#thongtin").hide();
                        $("#dangnhap").show();
                    }
                }
            });

        })
    </script>
</body>

</html>
